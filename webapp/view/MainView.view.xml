<mvc:View
    controllerName="rapportavisqualite.controller.ViewAvis"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:layout="sap.ui.layout"
    xmlns:viz="sap.viz.ui5.controls"
    xmlns:viz.data="sap.viz.ui5.data"
    xmlns:form="sap.ui.layout.form"
    xmlns:viz.feeds="sap.viz.ui5.controls.common.feeds">

    <Page id="mainPage" title="Rapport des Avis">
        <customHeader>
            <Bar id="_IDGenBar">
                <contentLeft>
                    <Title id="_IDGenTitle" text="Rapport des Avis" />
                </contentLeft>
            </Bar>
        </customHeader>
        <content>
            <!-- Dashboard Section -->
             <Button id="_IDGenButton6" icon="sap-icon://hide" text="Afficher/Masquer le Dashboard" press="onToggleDashboard" />
            <VBox id="dashboardBox" class="sapUiSmallMarginBottom dashboardContainer" visible="true">
                <Title id="_IDGenTitle1" text="Tableau de Bord" level="H2" class="sapUiTinyMarginBottom" />
                <layout:Grid id="_IDGenGrid" defaultSpan="XL12 L12 M12 S12" class="sapUiTinyMargin">
                    <!-- Tiles and Chart in a Horizontal Layout -->
                    <layout:Grid id="_IDGenGrid1" defaultSpan="XL6 L6 M12 S12" class="sapUiTinyMargin">
                        <!-- Tiles -->
                        <layout:Grid id="_IDGenGrid2" defaultSpan="XL4 L4 M4 S12" class="sapUiTinyMargin">
                            <!-- Tile for Errors -->
                            <GenericTile
                                id="errorTile"
                                header="Erreurs"
                                subheader="Total"
                                class="sapUiTinyMargin dashboardTile errorTile"
                                press="onTilePress">
                                <TileContent id="_IDGenTileContent">
                                    <NumericContent
                                        id="errorCount"
                                        value="{dashboard>/stats/erreurs}"
                                        valueColor="Error"
                                        withMargin="false" />
                                </TileContent>
                            </GenericTile>
                            <!-- Tile for Warnings -->
                            <GenericTile
                                id="warningTile"
                                header="Warnings"
                                subheader="Total"
                                class="sapUiTinyMargin dashboardTile warningTile"
                                press="onTilePress">
                                <TileContent id="_IDGenTileContent1">
                                    <NumericContent
                                        id="warningCount"
                                        value="{dashboard>/stats/warnings}"
                                        valueColor="Critical"
                                        withMargin="false" />
                                </TileContent>
                            </GenericTile>
                            <!-- Tile for Success Rate -->
                            <GenericTile
                                id="successTile"
                                header="Taux de Succès"
                                subheader="Pourcentage"
                                class="sapUiTinyMargin dashboardTile successTile"
                                press="onTilePress">
                                <TileContent id="_IDGenTileContent2">
                                    <NumericContent
                                        id="successRate"
                                        value="{dashboard>/stats/tauxSucces}"
                                        formatterValue="true"
                                        valueColor="Good"
                                        withMargin="false"
                                        scale="%" />
                                </TileContent>
                            </GenericTile>
                        </layout:Grid>
                        <!-- Chart -->
                        <VBox id="_IDGenVBox1" class="chartContainer" fitContainer="true">
                            <viz:VizFrame
                                id="statusChart"
                                vizType="donut"
                                width="100%"
                                height="200px"
                                vizProperties="{title: {text: 'Répartition des Statuts'}}">
                                <viz:dataset>
                                    <viz.data:FlattenedDataset id="_IDGenFlattenedDataset" data="{dashboard>/chartData}">
                                        <viz.data:dimensions>
                                            <viz.data:DimensionDefinition id="_IDGenDimensionDefinition"
                                                name="Catégorie"
                                                value="{dashboard>categorie}" />
                                        </viz.data:dimensions>
                                        <viz.data:measures>
                                            <viz.data:MeasureDefinition id="_IDGenMeasureDefinition"
                                                name="Valeur"
                                                value="{dashboard>valeur}" />
                                        </viz.data:measures>
                                    </viz.data:FlattenedDataset>
                                </viz:dataset>
                                <viz:feeds>
                                    <viz.feeds:FeedItem id="_IDGenFeedItem"
                                        uid="size"
                                        type="Measure"
                                        values="Valeur" />
                                    <viz.feeds:FeedItem id="_IDGenFeedItem1"
                                        uid="color"
                                        type="Dimension"
                                        values="Catégorie" />
                                </viz:feeds>
                            </viz:VizFrame>
                        </VBox>
                    </layout:Grid>
                </layout:Grid>
            </VBox>

            <!-- Barre d'options -->
            <HBox id="_IDGenHBox" class="sapUiSmallMargin sapUiSmallMarginBottom" justifyContent="Start">
                <Button id="_IDGenButton" text="Général" press="onShowGeneral" />
                <Button id="_IDGenButton1" text="Délai" press="onShowDelai" class="sapUiSmallMarginBeginEnd" />
                <Button id="_IDGenButton2" text="Vérification" press="onShowVerification" />
            </HBox>

            <!-- Barre de filtres personnalisée -->
            <VBox id="filterBox" class="sapUiSmallMargin">
                <HBox id="_IDGenHBox1">
                    <Label id="_IDGenLabel" text="Numéro d'avis" class="sapUiSmallMarginEnd" />
                    <Input id="numeroAvisInput" width="200px" placeholder="Rechercher..." />
                    <Label id="_IDGenLabel1" text="Type d'avis" class="sapUiSmallMarginEnd sapUiSmallMarginBegin" />
                    <Input id="typeAvisInput" width="200px" placeholder="Rechercher..." />
                    <Label id="_IDGenLabel2" text="Statut de l'avis" class="sapUiSmallMarginEnd sapUiSmallMarginBegin" />
                    <Input id="statutAvisInput" width="200px" placeholder="Rechercher..." />
                    <Button id="_IDGenButton3" text="Filtrer" press="onFilter" class="sapUiSmallMarginBegin" />
                </HBox>
                
            </VBox>

            <!-- Tableau principal : Général -->
            <Table id="avisTable" items="{localAvis>/avis}" inset="false" visible="true">
                <columns>
                    <Column id="_IDGenColumn"><Text id="ezerze" text="Numéro d'avis" /></Column>
                    <Column id="_IDGenColumn1"><Text id="ezree" text="Type d'avis" /></Column>
                    <Column id="_IDGenColumn2"><Text id="eerzeze" text="Statut de l'avis" /></Column>
                    <Column id="_IDGenColumn3"><Text id="eerze" text="Date de l'avis" /></Column>
                    <Column id="_IDGenColumn4"><Text id="rezeze" text="Créé par" /></Column>
                    <Column id="_IDGenColumn5"><Text id="efsdfze" text="Article" /></Column>
                    <Column id="_IDGenColumn6"><Text id="ezere" text="Description d'article" /></Column>
                    <Column id="_IDGenColumn7"><Text id="ezsfe" text="Âge du dossier" /></Column>
                    <Column id="_IDGenColumn8"><Text id="esdfsfze" text="" /></Column>
                </columns>
                <items>
                    <ColumnListItem id="_IDGenColumnListItem">
                        <cells>
                            <Text id="ezsze" text="{localAvis>numero}" />
                            <Text id="eztrye" text="{localAvis>type}" />
                            <Text id="ezyje" text="{localAvis>statut}" />
                            <Text id="ezvcxce" text="{localAvis>date}" />
                            <Text id="ezsdse" text="{localAvis>creePar}" />
                            <Text id="ezetyt" text="{localAvis>article}" />
                            <Text id="ezuyuie" text="{localAvis>description}" />
                            <Text id="ehjze" text="{localAvis>age}" />
                            <HBox id="_IDGenHBoxCells">
                                <Button id="_IDGenButton4" icon="sap-icon://hint" press="onShowFullVerificationReport" tooltip="Plus d'infos" />
                                <Button id="_IDGenButtonNew" icon="sap-icon://form" press="onShowEditForm" tooltip="Ouvrir le formulaire" class="sapUiTinyMarginBegin" />
                                <Button id="_IDGenButtonDownload" icon="sap-icon://download" press="onDownloadRow" tooltip="Télécharger la ligne" class="sapUiTinyMarginBegin" />
                            </HBox>
                        </cells>
                    </ColumnListItem>
                </items>
            </Table>

            <!-- Deuxième tableau : Délai -->
            <Table id="delaiTable" items="{localAvis>/avis}" visible="false">
                <columns>
                    <Column id="_IDGenColumn9"><Text id="eazaze" text="Numéro d'avis" /></Column>
                    <Column id="_IDGenColumn10"><Text id="eesze" text="Temps de cycle des dispositions" /></Column>
                    <Column id="_IDGenColumn11"><Text id="eazze" text="Feu de circulation" /></Column>
                    <Column id="_IDGenColumn12"><Text id="ehgfze" text="Délai AQ" /></Column>
                    <Column id="_IDGenColumn13"><Text id="eereze" text="Délai AQ Feu de circulation" /></Column>
                    <Column id="_IDGenColumn14"><Text id="ezeazze" text="Délai Service Détecteur" /></Column>
                    <Column id="_IDGenColumn15"><Text id="eqsze" text="Délai Service Détecteur Feu de circulation" /></Column>
                </columns>
                <items>
                    <ColumnListItem id="_IDGenColumnListItem1">
                        <cells>
                            <Text id="eyujyze" text="{localAvis>numero}" />
                            <Text id="esdze" text="{localAvis>tempsCycle}" />
                            <Text id="ezxwwxe" text="{localAvis>feu}" />
                            <Text id="esqsqsze" text="{localAvis>delaiAQ}" />
                            <Text id="esqdze" text="{localAvis>delaiAQFeu}" />
                            <Text id="esqsze" text="{localAvis>delaiDetecteur}" />
                            <Text id="eqze" text="{localAvis>delaiDetecteurFeu}" />
                        </cells>
                    </ColumnListItem>
                </items>
            </Table>

            <!-- Dialog for Verification Report -->
            <Dialog id="verifDialog" title="Rapport de vérification" draggable="true" resizable="true">
                <VBox id="_IDGenVBox" class="sapUiSmallMargin">
                    <Text id="verifRapportText" text="Chargement..." />
                </VBox>
                <endButton>
                    <Button id="_IDGenButton5" text="Fermer" press="onCloseVerifDialog" />
                </endButton>
            </Dialog>
            <!-- Nouveau Dialog pour le formulaire -->
<Dialog id="editFormDialog" title="Formulaire de l'Avis" draggable="true" resizable="true">
    <VBox id="_IDGenVBoxForm" class="sapUiSmallMargin">
        <form:SimpleForm id="editAvisForm" editable="true" layout="ResponsiveGridLayout">
            <form:content>
                <Label id="_IDGenLabelForm1" text="Numéro d'avis" />
                <Input id="formNumero" value="{formModel>/numero}" enabled="false" />
                <Label id="_IDGenLabelForm2" text="Type d'avis" />
                <Input id="formType" value="{formModel>/type}" />
                <Label id="_IDGenLabelForm3" text="Statut de l'avis" />
                <Input id="formStatut" value="{formModel>/statut}" />
                <Label id="_IDGenLabelForm4" text="Date de l'avis" />
                <Input id="formDate" value="{formModel>/date}" />
                <Label id="_IDGenLabelForm5" text="Créé par" />
                <Input id="formCreePar" value="{formModel>/creePar}" />
                <Label id="_IDGenLabelForm6" text="Article" />
                <Input id="formArticle" value="{formModel>/article}" />
                <Label id="_IDGenLabelForm7" text="Description" />
                <Input id="formDescription" value="{formModel>/description}" />
                <Label id="_IDGenLabelForm8" text="Âge du dossier" />
                <Input id="formAge" value="{formModel>/age}" />
            </form:content>
        </form:SimpleForm>
    </VBox>
    <beginButton>
        <Button id="_IDGenButtonSave" text="Enregistrer" press="onSaveForm" />
    </beginButton>
    <endButton>
        <Button id="_IDGenButtonCloseForm" text="Fermer" press="onCloseEditForm" />
    </endButton>
</Dialog>
        </content>
    </Page>
</mvc:View>
